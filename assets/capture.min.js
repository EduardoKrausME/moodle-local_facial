!function(){var a,o,r,i,n,s,c=640,d="Capturar foto e enviar",e=!1,u=null;function t(){e||(a=o.videoHeight/(o.videoWidth/c),isNaN(a)&&(a=c/(4/3)),o.setAttribute("width",c),o.setAttribute("height",a),r.setAttribute("width",c),r.setAttribute("height",a),e=!0)}function l(){!function(){var e={video:!0,audio:!1};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(e).then(function(t){try{o.srcObject=t}catch(e){o.src=window.URL.createObjectURL(t)}o.play(),s.hide(),i.show(),n.html(d).prop("disabled",!1)},function(e){return console.log(e),u.html("Navegador não possui suporte a reconhecimento!<br><br>Você precisa de um computador com WebCam.<br><br>Sistema não funciona em iPhone e iPad. Use o aplicativo!").addClass("error"),$(".video-container,#capture-button,#start-area").hide(),i.show(),!1});else{if(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,void 0===navigator.getMedia)return console.log(navigator.getMedia),u.html("Navegador não possui suporte a reconhecimento!<br><br>Você precisa de um computador com WebCam.<br><br>Sistema não funciona em celulares ou tablets. Use o aplicativo!").addClass("error"),$(".video-container,#capture-button,#start-area").hide(),i.show();navigator.getMedia(e,function(e){if(navigator.mozGetUserMedia)o.mozSrcObject=e;else{var t=window.URL||window.webkitURL;o.src=t.createObjectURL(e)}},function(e){return console.log(e),u.html("Um erro ocorreu ao carregar a câmera:<br> "+e).addClass("error"),$(".video-container,#capture-button,#start-area").hide(),i.show(),!1})}}();try{n.html(d).prop("disabled",!1),s.hide(),i.show()}catch(e){console.log(e)}}function m(){event.preventDefault(),function(){var e=r.getContext("2d");if(c&&a){r.width=c,r.height=a,e.drawImage(o,0,0,c,a);var t=r.toDataURL("image/jpeg",.8);u.html("").removeClass("error"),n.html("Enviando imagem para o servidor...").prop("disabled",!0),$.post("fotossalvar.php",{courseid:courseid,imagem:t},function(e){console.log(e),"success"==e.status?window.location=request_uri:(u.html(e.message).addClass("error"),n.html(d).prop("disabled",!1))},"json").fail(function(e){e.html("Erro ao enviar a imagem ao servidor. Capture novemente!").addClass("error"),n.html(d).prop("disabled",!1)})}}()}$(function(){o=document.getElementById("video"),r=document.getElementById("canvas"),i=$("#contentarea"),n=$("#capture-button"),$("#playbutton"),s=$("#start-area"),u=$("#error"),s.click(l),n.click(m),o.addEventListener("canplay",t,!1)})}();